---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: zigbee2mqtt
  namespace: argocd
spec:
  project: default
  destination:
    server: https://kubernetes.default.svc
    namespace: zigbee2mqtt
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
  source:
    repoURL: https://k8s-at-home.com/charts/
    chart: zigbee2mqtt
    targetRevision: 9.0.0
    helm:
      valuesObject:
        image:
          repository: koenkk/zigbee2mqtt
          tag: latest-dev
        env:
          TZ: "America/Sao_Paulo"
          ZIGBEE2MQTT_DATA: /data
        config:
          homeassistant: true
          permit_join: true
          mqtt:
            base_topic: zigbee2mqtt
            server: "mqtt://mosquitto"
          serial:
            port: /dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B001CDD33E2-if00
          frontend:
            port: 8080
          experimental:
            new_api: true
          advanced:
            log_output:
              - console
            log_level: error
        persistence:
          config:
            enabled: true
            storageClass: longhorn
            accessMode: ReadWriteOnce
            size: 1Gi
            mountPath: "/data"
          usb:
            enabled: true
            type: hostPath
            hostPath: /dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B001CDD33E2-if00
            hostPathType: CharDevice
        securityContext:
          privileged: true