# https://github.com/k8s-home-lab/helm-charts 
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: home-assistant
  namespace: argocd
spec:
  project: default
  destination:
    server: https://kubernetes.default.svc
    namespace: home-assistant
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
  source:
    repoURL: http://pajikos.github.io/home-assistant-helm-chart/
    chart: home-assistant
    targetRevision: "*"
    helm:
      valuesObject:
        configuration:
          # Enable or disable the configuration setup for Home Assistant
          enabled: true
          # Force init will merge the current configuration file with the default configuration on every start
          # This is useful when you want to ensure that the configuration file is always up to date
          forceInit: true
          # List of trusted proxies in the format of CIDR notation in a case of using a reverse proxy
          # Here is the list of the most common private IP ranges, use your list of possible trusted proxies, usually, it's the IP of the reverse proxy
          trusted_proxies:
            - 10.42.0.0/16      # Add the IP address of your cluster CIDR

      serviceMonitor:
        # requires HA integration:  https://www.home-assistant.io/integrations/prometheus/
        enabled: true