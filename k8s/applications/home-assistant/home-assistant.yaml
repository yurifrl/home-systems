# https://github.com/k8s-home-lab/helm-charts 
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: home-assistant
  namespace: argocd
spec:
  project: default
  destination:
    server: https://kubernetes.default.svc
    namespace: home-assistant
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
  source:
    repoURL: http://pajikos.github.io/home-assistant-helm-chart/
    chart: home-assistant
    targetRevision: "*"
    helm:
      valuesObject:
        # Will not use but it will generate the config https://github.com/pajikos/home-assistant-helm-chart/blob/43198feb6173c5d3cb9a082e2115d60e3d3f99aa/charts/home-assistant/values.yaml#L181
        # ingress:
        #   enabled: true
        # Configuration for Home Assistant
        configuration:
          # Enable or disable the configuration setup for Home Assistant
          enabled: true
          # Force init will merge the current configuration file with the default configuration on every start
          # This is useful when you want to ensure that the configuration file is always up to date
          forceInit: true

          templateConfig: |-
            # Loads default set of integrations. Do not remove.
            default_config:

            http:
              use_x_forwarded_for: true
              trusted_proxies:
                - 10.42.0.45/32
            # Load frontend themes from the themes folder
            frontend:
              themes: !include_dir_merge_named themes

            automation: !include automations.yaml
            script: !include scripts.yaml
            scene: !include scenes.yaml


        addons:
          codeserver:
            enabled: true