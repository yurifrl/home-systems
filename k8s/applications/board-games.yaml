apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: board-games
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  destination:
    server: https://kubernetes.default.svc
    namespace: board-games
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
    managedNamespaceMetadata:
      labels:
        istio.io/dataplane-mode: ambient
  sources:
    - repoURL: https://github.com/yurifrl/home-systems.git
      targetRevision: HEAD
      path: k8s/charts/support
      helm:
        valuesObject:
          configMaps:
            - name: board-games-config
              data:
                config.yaml: |
                  port: 8080
                  log_level: info
                  github:
                    owner: yurifrl
                    repo: Obsidian
                    path: .data/inventory.yaml
                    ref: heads/main
                    interval_seconds: 10
          externalSecrets:
            - name: board-games
          services:
            - name: board-games
              port: 8080
          deployments:
            - name: board-games
              image:
                repository: ghcr.io/yurifrl/board-games
                tag: latest
              containerPort: 8080
              envFrom:
                - secretRef:
                    name: board-games
              volumes:
                - name: config
                  configMap:
                    name: board-games-config
              volumeMounts:
                - name: config
                  mountPath: /app/config.yaml
                  subPath: config.yaml
          virtualServices:
            - name: board-games
              hosts:
                - bg.monaddaydream.com
                - bg.syscd.live
                - bg.syscd.tech
              service:
                name: board-games
                namespace: board-games
                port: 8080

