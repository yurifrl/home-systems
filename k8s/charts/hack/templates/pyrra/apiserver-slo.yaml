apiVersion: pyrra.dev/v1alpha1
kind: ServiceLevelObjective
metadata:
  name: apiserver-availability
  namespace: monitoring
  labels:
    prometheus: k8s
    role: alert-rules
    pyrra.dev/owner: sre-team
    pyrra.dev/tier: "0"
spec:
  target: "99.95"
  window: 2w
  description: "SLO based on successful API server request responses"
  indicator:
    ratio:
      errors:
        metric: apiserver_request_total{code=~"5.*"}
      total:
        metric: apiserver_request_total 

---

apiVersion: pyrra.dev/v1alpha1
kind: ServiceLevelObjective
metadata:
  name: pyrra-api-errors
  namespace: monitoring
  labels:
    prometheus: k8s
    role: alert-rules
    pyrra.dev/team: operations # Any labels prefixed with 'pyrra.dev/' will be propagated as Prometheus labels, while stripping the prefix.
spec:
  target: "99"
  window: 2w
  description: Pyrra's API requests and response errors over time grouped by route.
  indicator:
    ratio:
      errors:
        metric: http_requests_total{code=~"5.."}
      total:
        metric: http_requests_total{}