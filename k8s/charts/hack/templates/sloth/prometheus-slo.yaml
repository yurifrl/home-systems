apiVersion: sloth.slok.dev/v1
kind: PrometheusServiceLevel
metadata:
  name: sloth-slo-apiserver
  namespace: monitoring
spec:
  service: kubernetes-apiserver
  labels:
    owner: sre-team
    tier: "0"
  slos:
    - name: apiserver-availability
      objective: 99.95
      description: SLO based on successful API server request responses
      sli:
        events:
          errorQuery: |
            sum(rate(apiserver_request_total{code=~5.*}[{{.window}}]))
          totalQuery: |
            sum(rate(apiserver_request_total[{{.window}}]))
      alerting:
        name: KubernetesAPIServerHighErrorRate
        labels:
          category: availability
          component: apiserver
        annotations:
          summary: High error rate on Kubernetes API server responses
          description: Kubernetes API server is experiencing elevated error rates
        pageAlert:
          labels:
            severity: critical
            team: sre
        ticketAlert:
          labels:
            severity: warning
            slack_channel: "#sre-alerts"