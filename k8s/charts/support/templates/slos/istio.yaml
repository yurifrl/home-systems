apiVersion: slo.prometheus-operator.dev/v1alpha1
kind: ServiceLevelObjective
metadata:
  name: istio-gateway-availability
  namespace: monitoring
  labels:
    prometheus: k8s
    role: alert-rules
spec:
  description: Availability of the Istio Gateway
  target: 99.9
  window: 30d
  indicator:
    ratio:
      errors:
        metric: envoy_cluster_upstream_cx_connect_fail{cluster_name="BlackHoleCluster"}
      total:
        metric: envoy_cluster_upstream_cx_total{cluster_name="BlackHoleCluster"}
---
apiVersion: slo.prometheus-operator.dev/v1alpha1
kind: ServiceLevelObjective
metadata:
  name: istiod-availability
  namespace: monitoring
  labels:
    prometheus: k8s
    role: alert-rules
spec:
  description: Availability of Istiod control plane
  target: 99.9
  window: 30d
  indicator:
    ratio:
      errors:
        metric: pilot_xds_push_errors_total
      total:
        metric: pilot_xds_pushes_total
---
apiVersion: slo.prometheus-operator.dev/v1alpha1
kind: ServiceLevelObjective
metadata:
  name: istio-gateway-latency
  namespace: monitoring
  labels:
    prometheus: k8s
    role: alert-rules
spec:
  description: Latency SLO for Istio Gateway
  target: 99
  window: 30d
  indicator:
    latency:
      success:
        metric: istio_request_duration_milliseconds_bucket{reporter="source",destination_workload="istio-gateway"}
      total:
        metric: istio_request_duration_milliseconds_count{reporter="source",destination_workload="istio-gateway"}
      latency: 300 