apiVersion: v1
kind: ConfigMap
metadata:
  name: echotube-channels-input
  annotations:
    helm.sh/hook: pre-install,pre-upgrade
    helm.sh/hook-weight: "-5"
    helm.sh/hook-delete-policy: hook-succeeded
data:
{{- range $i, $inst := .Values.instances | default (list) }}
  {{ $inst.name }}.json: |
{{ ($.Files.Get (printf "files/%s.json" $inst.name) | default "[]") | nindent 4 }}
{{- end }}