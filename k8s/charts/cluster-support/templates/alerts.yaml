apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: alertmanager-config
  namespace: monitoring
spec:
  route:
    receiver: 'discord-warnings'
    groupBy: ['alertname', 'job']
    groupWait: 30s
    groupInterval: 5m
    repeatInterval: 4h
    routes:
      - matchers:
          - severity = "critical"
        receiver: 'discord-critical'
        groupWait: 10s
        groupInterval: 1m
        repeatInterval: 1h
  receivers:
    - name: 'discord-critical'
      webhookConfigs:
        - urlSecret:
            name: alertmanager-discord
            key: webhook-url
          sendResolved: true
    - name: 'discord-warnings'
      webhookConfigs:
        - urlSecret:
            name: alertmanager-discord
            key: webhook-url
          sendResolved: true
  inhibitRules:
    - sourceMatchers:
        - severity = "critical"
      targetMatchers:
        - severity = "warning"
      equal:
        - alertname
        - namespace