acl internal {
  192.168.0.0/16;    # All local networks in 192.168.x.x range
  198.19.0.0/16;     # Broader network range
};

options {
  directory "/var/cache/bind";
  
  recursion yes;           # Enable recursion
  allow-recursion {        # Only allow internal networks to use recursion
    internal;              # Uses your existing ACL
    localhost;
  };
  
  forwarders {
    1.1.1.1;
    1.0.0.1;
    8.8.8.8;
  };
  
  # Allow DNS queries from internal networks
  allow-query {
    any;                  # Temporarily allow all queries for debugging
  };
  
  # Allow cache queries from internal networks
  allow-query-cache {
    internal;
    localhost;
  };
  
  # Setting to YES resolves the REFUSED error for external domains
  dnssec-validation auto;
  
  # Helps with caching and performance
  max-cache-ttl 86400;
  max-ncache-ttl 86400;
};

zone "syscd.dev" IN {
    type master;
    file "/etc/bind/zones/syscd.dev.zone";
    journal "/var/lib/bind/syscd.dev.zone.jnl";
    allow-transfer {
        key "rfc2136_tsig_secret";
    };
    allow-update {
      key "rfc2136_tsig_secret";
    };
};

# Include the keys configuration
include "/etc/bind/keys.conf"; 