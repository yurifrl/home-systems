# ifconfig | grep "inet " | grep -v 127.0.0.1
acl internal {
  192.168.0.0/16;    # All local networks in 192.168.x.x range
  198.19.0.0/16;     # Broader network range
  # 10.0.0.0/8;        # All kubernetes and internal networks (I know that for what I want it at works without this)
};

options {
  directory "/var/cache/bind";
  
  recursion yes;           # Enable recursion
  allow-recursion {        # Only allow internal networks to use recursion
    internal;              # Uses your existing ACL
    localhost;
  };
  
  forwarders {
    1.1.1.1;
    1.0.0.1;
    8.8.8.8;
  };
  
  # # Allow DNS queries from internal networks
  # allow-query {
  #   any;                  # Temporarily allow all queries for debugging
  # };
  
  # # Allow cache queries from internal networks
  # allow-query-cache {
  #   internal;
  #   localhost;
  # };
  
  # # Setting to YES resolves the REFUSED error for external domains
  # dnssec-validation auto;
  
  # # Helps with caching and performance
  # max-cache-ttl 86400;
  # max-ncache-ttl 86400;
};

zone "syscd.dev" IN {
    type master;
    file "/etc/bind/syscd.dev.zone";
    journal "/var/lib/bind/syscd.dev.zone.jnl";
    allow-transfer {
        key "rfc2136_tsig_secret";
    };
    # Is either allow-update or update-policy, not both
    allow-update {
      key "rfc2136_tsig_secret";
    };
    # allow-query {
    #   any;                # Allow queries for this zone from anywhere
    # };
};
# Include the keys configuration, it will come from a secret previously created
include "/etc/bind/keys.conf";